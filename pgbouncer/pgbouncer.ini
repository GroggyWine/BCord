# ============================================
# PgBouncer Configuration
# Added: 2025-12-19
# Purpose: Connection pooling for PostgreSQL
# ============================================

[databases]
# Format: dbname = host=hostname port=port dbname=dbname
bcord = host=bcord-postgres port=5432 dbname=bcord

[pgbouncer]
# Connection pooling mode
# session = connection assigned for entire session (safest)
# transaction = connection returned after each transaction (recommended)
# statement = connection returned after each statement (not recommended for complex apps)
pool_mode = transaction

# Listening settings
listen_addr = 0.0.0.0
listen_port = 6432

# Authentication
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

# Pool settings
# Maximum connections to PostgreSQL
max_db_connections = 25

# Maximum client connections to PgBouncer
max_client_conn = 500

# Default pool size per user/database pair
default_pool_size = 20

# Minimum pool size (keep connections warm)
min_pool_size = 5

# Reserve pool for sudden spikes
reserve_pool_size = 5
reserve_pool_timeout = 3

# Connection timeouts
server_connect_timeout = 5
server_idle_timeout = 300
server_lifetime = 3600

# Query timeouts (0 = disabled)
query_timeout = 0
query_wait_timeout = 120

# Client idle timeout
client_idle_timeout = 0

# Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1

# Admin settings
admin_users = bcord
stats_users = bcord

# TCP keepalive
tcp_keepalive = 1
tcp_keepidle = 30
tcp_keepintvl = 10
tcp_keepcnt = 3
